<!--
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.

Copyright (c) 2021-present Kaleidos Ventures SL
-->

<ng-container *transloco="let t">
  <ng-container *ngIf="model$ | async as vm">
    <div class="assignees-wrapper">
      <h2
        [ngClass]="{
          'assignee-title': vm.assigned.length > 0,
          'unassign-title': vm.assigned.length === 0
        }">
        <ng-container *ngIf="vm.assigned.length">{{
          t('project.assign_user.title')
        }}</ng-container>
        <ng-container *ngIf="!vm.assigned.length">{{
          t('project.assign_user.unassigned')
        }}</ng-container>
      </h2>
    </div>
    <ul *ngIf="vm.assigned.length">
      <li *ngFor="let assignedUser of vm.assigned; trackBy: trackByMember">
        <button
          class="user-row"
          [class.view-only]="viewOnly"
          type="button"
          (click)="unassign.next(assignedUser)">
          <div class="user">
            <tg-user-avatar
              size="m"
              class="no-border"
              [color]="assignedUser.color"
              [user]="assignedUser"
              type="light"
              [rounded]="true"
              aria-hidden="true"></tg-user-avatar>
            <span class="user-identifier">{{
              assignedUser.fullName || assignedUser.username
            }}</span>
          </div>
          <tui-svg
            *ngIf="!viewOnly"
            class="unassign-btn"
            [tuiHint]="tooltip"
            tuiHintDirection="bottom-right"
            src="close">
          </tui-svg>
        </button>
      </li>
    </ul>

    <ng-template #tooltip>
      <p>{{ t('project.assign_user.remove-assignee') }}</p>
    </ng-template>

    <ng-container *ngIf="!viewOnly">
      <form
        class="search-form"
        [formGroup]="searchTextForm">
        <tg-ui-input
          [icon]="'search'"
          [label]="t('project.assign_user.add')">
          <input
            inputRef
            tuiAutoFocus
            formControlName="searchText"
            type="search"
            [placeholder]="t('project.assign_user.search-members')"
            (ngModelChange)="search$.next(searchTextForm.value.searchText)" />
        </tg-ui-input>
      </form>

      <tui-scrollbar class="scrollbar-members">
        <ul>
          <li *ngFor="let member of vm.members; trackBy: trackByMember">
            <button
              class="unassigned-member-row"
              type="button"
              (click)="onAssign(member)">
              <tg-user-card
                class="card"
                [user]="member"
                [isSelf]="vm.currentUser.username === member.username"
                [navigateToUser]="false">
              </tg-user-card>
              <tui-svg
                class="assign-btn"
                [tuiHint]="tooltipAssign"
                tuiHintDirection="bottom-right"
                src="plus">
              </tui-svg>
            </button>
          </li>
        </ul>
      </tui-scrollbar>
      <ng-template #tooltipAssign>
        <p>{{ t('project.assign_user.add-assignee') }}</p>
      </ng-template>
    </ng-container>
  </ng-container>
</ng-container>
