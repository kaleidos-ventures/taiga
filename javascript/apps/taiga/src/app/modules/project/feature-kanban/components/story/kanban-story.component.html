<!--
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.

Copyright (c) 2021-present Kaleidos Ventures SL
-->
<ng-container *transloco="let t">
  <ng-container *ngIf="model$ | async as vm">
    <a
      [href]="
        '/project/' +
        vm.project.id +
        '/' +
        vm.project.slug +
        '/stories/' +
        story.ref
      "
      (click)="openStory($event)"
      [attr.aria-label]="
        !vm.isA11yDragInProgress
          ? t('kanban.story_title_a11y', {
              ref: story.ref,
              title: story.title,
              position: index + 1,
              total: total
            })
          : null
      "
      [attr.title]="
        t('kanban.story_title', {
          ref: story.ref,
          title: story.title,
          position: index + 1,
          total: total
        })
      "
      class="story-kanban-ref-focus">
      <div class="story-title">
        <div class="draggable-icon">
          <tui-svg src="draggable"></tui-svg>
        </div>
        <div class="ref">{{ story.ref }}</div>
        <div class="text">{{ story.title }}</div>
      </div>
      <div
        class="assign-user"
        [tuiDropdown]="assignUser"
        [tuiDropdownMinHeight]="272"
        [tuiDropdownMaxHeight]="530"
        [tuiDropdownManual]="vm.showAssignUser"
        (tuiActiveZoneChange)="onAssignUserActiveZoneChange($event)">
        <button (click)="toggleAssingUser($event)">assign</button>
      </div>
    </a>
    <!--
  User can modify to add users:

    *hasPermission="
    ['create'];
    entity: 'modify';
  "> -->

    <ng-template #assignUser>
      <tg-assign-user
        [assigned]="story.assignedTo"
        (assign)="assign($event)"
        (unassign)="unassign($event)"
        (requestClose)="closeAssignDropdown()"></tg-assign-user>
    </ng-template>
  </ng-container>
</ng-container>
