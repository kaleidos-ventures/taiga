<!--
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.

Copyright (c) 2021-present Kaleidos Ventures SL
-->
<ng-container *transloco="let t">
  <ng-container *ngIf="model$ | async as vm">
    <ng-container *ngIf="vm.project">
      <tg-title
        [title]="
          t('project_overview.title', { projectName: vm.project.name })
        "></tg-title>
      <div class="project-content">
        <div class="project-title">
          <tg-ui-avatar
            size="xxl"
            type="light"
            [color]="vm.project.color"
            [avatarUrl]="vm.project.logoLarge"
            [name]="vm.project.name">
          </tg-ui-avatar>
          <h1
            class="project-name"
            id="main-area-title"
            data-test="project-name">
            {{ vm.project.name }}
          </h1>

          <button
            data-test="edit-project"
            *ngIf="vm.project.userIsAdmin"
            class="edit-project-info"
            appearance="tertiary"
            tuiButton
            (click)="showEditProjectModal = true"
            icon="pen"
            iconAlign="left">
            {{ t('project_overview.edit_project_info') }}
          </button>
        </div>
        <div class="project-content-inner">
          <section class="project-main"></section>
          <section
            class="project-description"
            data-test="project-description"
            *ngIf="vm.project.userIsAdmin || vm.project.description?.length">
            <h2 class="project-about">
              {{ t('project_overview.about') }}
            </h2>
            <div
              [class.hide]="hideOverflow"
              class="description">
              <ng-container *ngIf="vm.project.description?.length">
                <p #descriptionOverflow>{{ vm.project.description }}</p>
              </ng-container>
              <ng-container *ngIf="!vm.project.description?.length">
                <p class="empty-description">
                  <button
                    data-test="add-description"
                    class="description-edit-project-action"
                    tuiLink
                    (click)="showEditProjectModal = true">
                    {{ t('project_overview.action_add_description') }}
                  </button>
                  {{ t('project_overview.action_add_description_continue') }}
                </p>
              </ng-container>
            </div>
            <div class="actions">
              <a
                *ngIf="showDescription && !hideOverflow"
                class="link"
                tuiLink
                (click)="toggleShowDescription()"
                icon="chevron-down"
                iconAlign="right">
                {{ t('project_overview.show_full_description') }}
              </a>
              <a
                *ngIf="showDescription && hideOverflow"
                class="link"
                tuiLink
                (click)="toggleShowDescription()"
                icon="chevron-up"
                iconAlign="right">
                {{ t('project_overview.hide_full_description') }}
              </a>
            </div>
          </section>
          <section class="project-members">
            <tg-project-members></tg-project-members>
          </section>
        </div>
      </div>

      <tg-edit-project
        *ngIf="showEditProjectModal"
        [show]="showEditProjectModal"
        (submitProject)="submitEditProject($event)"
        (closeModal)="showEditProjectModal = false"
        [project]="vm.project">
      </tg-edit-project>
    </ng-container>
  </ng-container>
</ng-container>
