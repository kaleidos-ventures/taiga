<!--
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.

Copyright (c) 2023-present Kaleidos INC
-->
<ng-container *ngIf="model$ | async as vm">
  <ng-container *transloco="let t">
    <div class="workspace-item-top">
      <tg-ui-avatar
        class="workspace-avatar"
        [color]="workspace.color"
        type="dark"
        size="m"
        [name]="workspace.name">
      </tg-ui-avatar>
      <div class="workspace-item-title-wrapper">
        <a
          *ngIf="
            workspace.userRole === 'admin' || workspace.userRole === 'member'
          "
          data-test="workspace-item-title"
          [routerLink]="['/workspace/', workspace.id, workspace.slug]"
          class="workspace-item-title workspace-item-title-active">
          {{ workspace.name }}
        </a>
        <span
          *ngIf="
            workspace.userRole === 'guest' || workspace.userRole === 'none'
          "
          class="workspace-item-title workspace-guest">
          {{ workspace.name }}
        </span>
      </div>

      <tg-ui-badge
        *ngIf="workspace.userRole"
        [label]="t('commons.roles.' + workspace.userRole)"
        size="s"
        [color]="workspace.userRole === 'guest' ? 'gray' : 'info'">
      </tg-ui-badge>
      <tg-ui-badge
        *ngIf="workspace.userIsOwner"
        [label]="t('commons.owner') | capitalize"
        size="s"
        color="primary">
      </tg-ui-badge>

      <div class="workspace-item-action">
        <button
          appearance="tertiary"
          tuiButton
          icon="user"
          type="button">
          {{ t('commons.members') }} (1)
        </button>
        <button
          *ngIf="workspace.userRole === 'admin'"
          appearance="secondary"
          tuiButton
          type="button">
          {{ t('commons.upgrade') }}
        </button>
        <a
          *ngIf="workspace.userRole === 'admin'"
          data-test="new-project-btn"
          appearance="primary"
          [routerLink]="['/new-project']"
          [queryParams]="{ workspace: workspace.id }"
          tuiButton
          icon="plus"
          type="button">
          {{ t('commons.project') }}
        </a>
      </div>
    </div>
    <div
      *ngIf="userHasNoAccess()"
      class="workspace-message-placeholder"
      [innerHtml]="t('workspace.placehoder_no_access')"></div>

    <!-- Case: User has no more projects -->
    <div
      *ngIf="userHasNoProjects()"
      class="workspace-message-placeholder"
      [innerHtml]="t('workspace.placehoder_no_projects')"></div>

    <!-- Project list -->
    <div
      [@.disabled]="animationDisabled"
      [class]="gridClass"
      [class.show-all]="vm.showAllProjects"
      class="workspace-item-card-grid">
      <tg-project-card
        *ngIf="
          workspace.latestProjects.length === 0 &&
          workspace.userRole === 'admin' &&
          vm.projects.length === 0
        "
        [workspace]="workspace"
        [acceptedInvites]="vm.acceptedInvites"
        variant="placeholder"
        [firstProject]="true">
      </tg-project-card>
      <div
        *ngFor="let invitation of vm.invitations; trackBy: trackByLatestProject"
        [@cardSlideOut]="vm.slideOutActive ? 'on' : 'off'"
        (@cardSlideOut.done)="slideOutAnimationDone($event)"
        [@newProject]="
          vm.newInvitations.includes(invitation.id) ? 'inprogress' : 'idle'
        "
        (@newProject.start)="newProjectAnimationStart($event, invitation)"
        (@newProject.done)="newProjectAnimationDone($event)"
        [@newInvitationSibling]="
          vm.projectSiblingToAnimate.includes(invitation.id)
            ? 'inprogress'
            : 'idle'
        "
        [@reorder]="reorder[invitation.id]"
        (@reorder.done)="reorderDone($event)">
        <tg-project-card
          variant="invitation"
          data-test="project-card-invitation"
          (rejectInvite)="rejectProjectInvite($event)"
          (acceptInvite)="acceptProjectInvite($event.id, $event.name)"
          [acceptedInvites]="vm.acceptedInvites"
          [workspace]="workspace"
          [project]="invitation">
        </tg-project-card>
      </div>
      <div
        *ngFor="let project of vm.projects; trackBy: trackByLatestProject"
        [@newProject]="
          newProjectsToAnimate.includes(project.id) ? 'inprogress' : 'idle'
        "
        (@newProject.start)="newProjectAnimationStart($event, project)"
        (@newProject.done)="newProjectAnimationDone($event)"
        [@newInvitationSibling]="
          vm.projectSiblingToAnimate.includes(project.id)
            ? 'inprogress'
            : 'idle'
        ">
        <tg-project-card
          data-test="project-card"
          [workspace]="workspace"
          [project]="project"
          [acceptedInvites]="vm.acceptedInvites"
          [@reorder]="reorder[project.id]"
          (@reorder.done)="reorderDone($event)">
        </tg-project-card>
      </div>
      <ng-container *ngIf="vm.workspacesSkeletonList.includes(workspace.id)">
        <div
          *ngFor="
            let _ of [].constructor(vm.skeletonToShow);
            trackBy: trackByIndex
          ">
          <tg-ui-card-skeleton></tg-ui-card-skeleton>
        </div>
      </ng-container>
    </div>
    <button
      *ngIf="vm.showMoreProjects"
      (click)="setShowAllProjects(true)"
      data-test="show-more-projects"
      tuiLink
      appearance="tertiary"
      class="workspace-show-all"
      icon="chevron-down">
      {{
        t('workspace.more_projects', {
          projects: vm.remainingProjects
        })
      }}
    </button>
    <button
      *ngIf="vm.showLessProjects"
      (click)="setShowAllProjects(false)"
      data-test="show-less-projects"
      tuiLink
      appearance="tertiary"
      class="workspace-show-all"
      icon="chevron-up">
      {{ t('workspace.less_projects') }}
    </button>
  </ng-container>
</ng-container>
