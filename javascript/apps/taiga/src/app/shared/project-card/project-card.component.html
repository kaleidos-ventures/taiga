<!--
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.

Copyright (c) 2023-present Kaleidos INC
-->

<ng-container *transloco="let t">
  <ng-container *ngIf="variant === 'placeholder'">
    <div class="project-item-card placeholder">
      <tg-ui-avatar
        type="light"
        [color]="0"
        [name]="''">
      </tg-ui-avatar>
      <a
        tuiLink
        [routerLink]="['/new-project']"
        [queryParams]="{ workspace: workspace.id }"
        data-test="create-project-card"
        class="project-item-link">
        <ng-container *ngIf="firstProject">
          {{ t('common_project.create_first_project') }}
        </ng-container>
        <ng-container *ngIf="!firstProject">
          {{ t('common_project.create_new_project') }}
        </ng-container>
      </a>
    </div>
  </ng-container>
  <ng-container *ngIf="variant === 'project' && project">
    <div class="project-item-card">
      <div class="project-card-title">
        <tg-ui-avatar
          class="project-card-image"
          type="light"
          [color]="project.color"
          [avatarUrl]="project.logoSmall"
          [name]="project.name">
        </tg-ui-avatar>
        <a
          [routerLink]="['/project', project.id, project.slug]"
          class="project-card-link"
          [class.is-admin]="workspace.userRole === 'admin' && hasActions"
          data-test="project-card-name">
          <h3
            [attr.aria-label]="
              t('common_project.card.a11y.project_name', {
                name: project.name
              })
            ">
            {{ project.name }}
          </h3>
        </a>
        <tui-hosted-dropdown
          *ngIf="workspace.userRole === 'admin' && hasActions"
          class="card-action"
          [tuiDropdownAlign]="'left'"
          [content]="projectActionsDropdown"
          [(open)]="projectActionsDropdownState">
          <button
            [attr.aria-label]="t('common_project.save_template')"
            icon="more-horizontal"
            appearance="action-button-2"
            tuiIconButton
            type="button"
            tuiHintDirection="top-right"
            [tuiHint]="t('project_overview.project_actions')"></button>
        </tui-hosted-dropdown>
      </div>
      <p class="project-card-description">{{ project.description }}</p>
    </div>
  </ng-container>
  <ng-container *ngIf="variant === 'invitation' && project">
    <div
      #invitationCardContainer
      data-animation="card-container">
      <button
        (click)="onRejectInvite()"
        data-test="project-reject-invite"
        class="project-reject-invite"
        tuiIconButton
        [@itemSlideOutAnimation]
        *ngIf="invitationStatus !== 'accepted'"
        appearance="action-button"
        [attr.aria-label]="t('commons.close')"
        [tuiHint]="t('common_project.card.close_card')"
        icon="close"
        type="button"></button>
      <div
        class="project-item-card"
        [@invitationAccepted]="animationAcceptedInvitation">
        <div
          class="card-badge-container"
          [@itemSlideOutAnimation]
          *ngIf="invitationStatus !== 'accepted'">
          <tg-ui-badge
            [label]="t('common_project.card.pending_invitation') | capitalize"
            icon="clock"
            color="gray">
          </tg-ui-badge>
        </div>
        <div class="project-card-title">
          <tg-ui-avatar
            class="project-card-image"
            type="light"
            [color]="project.color"
            [avatarUrl]="project.logoSmall"
            [name]="project.name">
          </tg-ui-avatar>
          <a
            [routerLink]="['/project', project.id, project.slug]"
            class="project-card-link"
            data-test="project-card">
            <h3
              [attr.aria-label]="
                t('common_project.card.a11y.project_name', {
                  name: project.name
                })
              ">
              {{ project.name }}
            </h3>
          </a>
        </div>
        <button
          class="project-accept-invite"
          tuiButton
          [@itemSlideOutAnimation]
          data-test="project-accept-invite"
          *ngIf="invitationStatus !== 'accepted'"
          (click)="acceptInvite.next({ id: project.id, name: project.name })"
          appearance="primary"
          type="button">
          {{ t('common_project.card.accept_invite') }}
        </button>
        <p
          class="project-card-description"
          [@itemSlideOutAnimation]
          (@itemSlideOutAnimation.done)="invitationAccepted()"
          *ngIf="invitationStatus === 'accepted'">
          {{ project.description }}
        </p>
      </div>
    </div>
  </ng-container>

  <ng-template #projectActionsDropdown>
    <tui-data-list class="view-options-list">
      <button
        class="view-option-btn"
        tuiOption
        type="button"
        (click)="openModalEvent('editProject')">
        <span class="view-option">
          <tui-svg
            aria-hidden="true"
            class="option-icon"
            src="pen"></tui-svg>
          <span class="option-name">{{
            t('common_project.edit_project')
          }}</span>
        </span>
      </button>
      <button
        class="view-option-btn"
        tuiOption
        type="button"
        (click)="openModalEvent('duplicate')">
        <span class="view-option">
          <tui-svg
            aria-hidden="true"
            class="option-icon"
            src="duplicate"></tui-svg>
          <span class="option-name">{{ t('common_project.duplicate') }}</span>
        </span>
      </button>
      <button
        class="view-option-btn"
        tuiOption
        type="button"
        (click)="openModalEvent('share')">
        <span class="view-option">
          <tui-svg
            aria-hidden="true"
            class="option-icon"
            src="folder"></tui-svg>
          <span class="option-name">{{ t('common_project.share') }}</span>
        </span>
      </button>
      <button
        class="view-option-btn"
        tuiOption
        type="button"
        (click)="openModalEvent('saveTemplate')">
        <span class="view-option">
          <tui-svg
            aria-hidden="true"
            class="option-icon"
            src="folder"></tui-svg>
          <span class="option-name">{{
            t('common_project.save_template')
          }}</span>
        </span>
      </button>
      <hr class="separator" />
      <button
        class="view-option-btn view-option-delete"
        tuiOption
        type="button"
        (click)="openModalEvent('deleteModal')">
        <span class="view-option">
          <tui-svg
            aria-hidden="true"
            class="option-icon"
            src="trash"></tui-svg>
          <span class="option-name">{{
            t('common_project.delete_project')
          }}</span>
        </span>
      </button>
    </tui-data-list>
  </ng-template>
</ng-container>
