{"version":3,"file":"taiga-ui-cdk-directives-overscroll.js","sources":["ng://@taiga-ui/cdk/directives/overscroll/overscroll.directive.ts","ng://@taiga-ui/cdk/directives/overscroll/overscroll.module.ts","ng://@taiga-ui/cdk/directives/overscroll/taiga-ui-cdk-directives-overscroll.ts"],"sourcesContent":["import {Directive, ElementRef, HostBinding, Inject, Input, NgZone} from '@angular/core';\nimport {TuiOverscrollMode} from '@taiga-ui/cdk/enums';\nimport {tuiZoneOptimized, typedFromEvent} from '@taiga-ui/cdk/observables';\nimport {TuiDestroyService} from '@taiga-ui/cdk/services';\nimport {TuiEventWith} from '@taiga-ui/cdk/types';\nimport {canScroll, getScrollParent} from '@taiga-ui/cdk/utils/dom';\nimport {Observable} from 'rxjs';\nimport {filter, switchMap, takeUntil, tap} from 'rxjs/operators';\n\n/**\n * Directive to isolate scrolling, i.e. prevent body scroll behind modal dialog\n * @dynamic\n */\n@Directive({\n    selector: '[tuiOverscroll]',\n    providers: [TuiDestroyService],\n})\nexport class TuiOverscrollDirective {\n    @Input('tuiOverscroll')\n    mode = TuiOverscrollMode.Scroll;\n\n    constructor(\n        @Inject(ElementRef) {nativeElement}: ElementRef<HTMLElement>,\n        @Inject(NgZone) ngZone: NgZone,\n        @Inject(TuiDestroyService) destroy$: Observable<void>,\n    ) {\n        typedFromEvent(nativeElement, 'wheel', {passive: false})\n            .pipe(\n                filter(() => this.enabled),\n                takeUntil(destroy$),\n                tuiZoneOptimized(ngZone),\n            )\n            .subscribe(event => {\n                this.processEvent(\n                    event,\n                    !!event.deltaY,\n                    event.deltaY ? event.deltaY < 0 : event.deltaX < 0,\n                );\n            });\n\n        typedFromEvent(nativeElement, 'touchstart')\n            .pipe(\n                switchMap(({touches}) => {\n                    let {clientX, clientY} = touches[0];\n                    let deltaX = 0;\n                    let deltaY = 0;\n                    let vertical: boolean;\n\n                    return typedFromEvent(nativeElement, 'touchmove', {\n                        passive: false,\n                    }).pipe(\n                        filter(() => this.enabled),\n                        tuiZoneOptimized(ngZone),\n                        tap(event => {\n                            // We have to have it in tap instead of subscribe due to variables in closure\n                            const changedTouch = event.changedTouches[0];\n\n                            deltaX = clientX - changedTouch.clientX;\n                            deltaY = clientY - changedTouch.clientY;\n                            clientX = changedTouch.clientX;\n                            clientY = changedTouch.clientY;\n\n                            if (vertical === undefined) {\n                                vertical = Math.abs(deltaY) > Math.abs(deltaX);\n                            }\n\n                            this.processEvent(\n                                event,\n                                vertical,\n                                vertical ? deltaY < 0 : deltaX < 0,\n                            );\n                        }),\n                    );\n                }),\n                takeUntil(destroy$),\n            )\n            .subscribe();\n    }\n\n    get enabled(): boolean {\n        return this.mode !== TuiOverscrollMode.None;\n    }\n\n    @HostBinding('style.overscrollBehavior')\n    get overscrollBehavior(): 'contain' | null {\n        return this.enabled ? 'contain' : null;\n    }\n\n    private processEvent(\n        event: TuiEventWith<Event, HTMLElement>,\n        vertical: boolean,\n        negative: boolean,\n    ) {\n        const {target, currentTarget, cancelable} = event;\n\n        if (!cancelable || !(target instanceof Element)) {\n            return;\n        }\n\n        // This is all what's needed in Chrome/Firefox thanks to CSS overscroll-behavior\n        if (\n            this.mode === TuiOverscrollMode.All &&\n            ((vertical && !currentTarget.contains(getScrollParent(target))) ||\n                (!vertical && !currentTarget.contains(getScrollParent(target, false))))\n        ) {\n            event.preventDefault();\n\n            return;\n        }\n\n        // This is Safari/IE/Edge fallback\n        if (\n            vertical &&\n            ((negative && !canScroll(target, currentTarget, true, false)) ||\n                (!negative && !canScroll(target, currentTarget, true, true)))\n        ) {\n            event.preventDefault();\n\n            return;\n        }\n\n        if (\n            !vertical &&\n            ((negative && !canScroll(target, currentTarget, false, false)) ||\n                (!negative && !canScroll(target, currentTarget, false, true)))\n        ) {\n            event.preventDefault();\n        }\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiOverscrollDirective} from './overscroll.directive';\n\n@NgModule({\n    declarations: [TuiOverscrollDirective],\n    exports: [TuiOverscrollDirective],\n})\nexport class TuiOverscrollModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}