{"version":3,"file":"taiga-ui-cdk-directives-focus-trap.js","sources":["ng://@taiga-ui/cdk/directives/focus-trap/focus-trap.directive.ts","ng://@taiga-ui/cdk/directives/focus-trap/focus-trap.module.ts","ng://@taiga-ui/cdk/directives/focus-trap/taiga-ui-cdk-directives-focus-trap.ts"],"sourcesContent":["import {DOCUMENT} from '@angular/common';\nimport {\n    Directive,\n    ElementRef,\n    HostListener,\n    Inject,\n    OnDestroy,\n    Renderer2,\n} from '@angular/core';\nimport {containsOrAfter} from '@taiga-ui/cdk/utils/dom';\nimport {\n    blurNativeFocused,\n    getClosestKeyboardFocusable,\n    getNativeFocused,\n    setNativeFocused,\n} from '@taiga-ui/cdk/utils/focus';\n\n// @dynamic\n@Directive({\n    selector: '[tuiFocusTrap]',\n    host: {\n        tabIndex: '0',\n    },\n})\nexport class TuiFocusTrapDirective implements OnDestroy {\n    private readonly activeElement = getNativeFocused(this.documentRef);\n\n    constructor(\n        @Inject(DOCUMENT) private readonly documentRef: Document,\n        @Inject(ElementRef)\n        private readonly elementRef: ElementRef<HTMLElement>,\n        @Inject(Renderer2) private readonly renderer: Renderer2,\n    ) {\n        /**\n         * This would cause currently focused element to lose focus\n         * but it might cause ExpressionChanged error due to potential HostBinding.\n         * Microtask keeps it in the same frame but allows change detection to run\n         */\n        Promise.resolve().then(() => {\n            setNativeFocused(this.elementRef.nativeElement);\n        });\n    }\n\n    @HostListener('blur')\n    onBlur() {\n        this.renderer.removeAttribute(this.elementRef.nativeElement, 'tabIndex');\n    }\n\n    @HostListener('window:focusin.silent', ['$event.target'])\n    onFocusIn(node: Node) {\n        if (containsOrAfter(this.elementRef.nativeElement, node)) {\n            return;\n        }\n\n        const focusable = getClosestKeyboardFocusable(\n            this.elementRef.nativeElement,\n            false,\n            this.elementRef.nativeElement,\n        );\n\n        if (focusable) {\n            setNativeFocused(focusable);\n        }\n    }\n\n    ngOnDestroy() {\n        blurNativeFocused(this.documentRef);\n\n        /**\n         * HostListeners are triggered even after ngOnDestroy\n         * {@link https://github.com/angular/angular/issues/38100}\n         * so we need to delay it but stay in the same sync cycle,\n         * therefore using Promise instead of setTimeout\n         */\n        Promise.resolve().then(() => {\n            if (this.activeElement instanceof HTMLElement) {\n                setNativeFocused(this.activeElement);\n            }\n        });\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiFocusTrapDirective} from './focus-trap.directive';\n\n@NgModule({\n    declarations: [TuiFocusTrapDirective],\n    exports: [TuiFocusTrapDirective],\n})\nexport class TuiFocusTrapModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":";;;;;;AAiBA;;IAUI,+BACuC,WAAqB,EAEvC,UAAmC,EAChB,QAAmB;QAJ3D,iBAcC;QAbsC,gBAAW,GAAX,WAAW,CAAU;QAEvC,eAAU,GAAV,UAAU,CAAyB;QAChB,aAAQ,GAAR,QAAQ,CAAW;QAN1C,kBAAa,GAAG,gBAAgB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;;;;;;QAahE,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;YACnB,gBAAgB,CAAC,KAAI,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;SACnD,CAAC,CAAC;KACN;IAGD,sCAAM,GAAN;QACI,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;KAC5E;IAGD,yCAAS,GAAT,UAAU,IAAU;QAChB,IAAI,eAAe,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,IAAI,CAAC,EAAE;YACtD,OAAO;SACV;QAED,IAAM,SAAS,GAAG,2BAA2B,CACzC,IAAI,CAAC,UAAU,CAAC,aAAa,EAC7B,KAAK,EACL,IAAI,CAAC,UAAU,CAAC,aAAa,CAChC,CAAC;QAEF,IAAI,SAAS,EAAE;YACX,gBAAgB,CAAC,SAAS,CAAC,CAAC;SAC/B;KACJ;IAED,2CAAW,GAAX;QAAA,iBAcC;QAbG,iBAAiB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;;;;;;;QAQpC,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;YACnB,IAAI,KAAI,CAAC,aAAa,YAAY,WAAW,EAAE;gBAC3C,gBAAgB,CAAC,KAAI,CAAC,aAAa,CAAC,CAAC;aACxC;SACJ,CAAC,CAAC;KACN;;gBAnDmD,QAAQ,uBAAvD,MAAM,SAAC,QAAQ;gBAEa,UAAU,uBADtC,MAAM,SAAC,UAAU;gBAE4B,SAAS,uBAAtD,MAAM,SAAC,SAAS;;IAarB;QADC,YAAY,CAAC,MAAM,CAAC;uDAGpB;IAGD;QADC,YAAY,CAAC,uBAAuB,EAAE,CAAC,eAAe,CAAC,CAAC;0DAexD;IAvCQ,qBAAqB;QANjC,SAAS,CAAC;YACP,QAAQ,EAAE,gBAAgB;YAC1B,IAAI,EAAE;gBACF,QAAQ,EAAE,GAAG;aAChB;SACJ,CAAC;QAKO,WAAA,MAAM,CAAC,QAAQ,CAAC,CAAA;QAChB,WAAA,MAAM,CAAC,UAAU,CAAC,CAAA;QAElB,WAAA,MAAM,CAAC,SAAS,CAAC,CAAA;OAPb,qBAAqB,CAwDjC;IAAD,4BAAC;CAxDD;;;ICjBA;KAAkC;IAArB,kBAAkB;QAJ9B,QAAQ,CAAC;YACN,YAAY,EAAE,CAAC,qBAAqB,CAAC;YACrC,OAAO,EAAE,CAAC,qBAAqB,CAAC;SACnC,CAAC;OACW,kBAAkB,CAAG;IAAD,yBAAC;CAAlC;;ACPA;;;;;;"}