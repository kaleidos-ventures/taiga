{"version":3,"file":"taiga-ui-kit-components-calendar-range.js","sources":["ng://@taiga-ui/kit/components/calendar-range/calendar-range.component.ts","ng://@taiga-ui/kit/components/calendar-range/calendar-range.module.ts","ng://@taiga-ui/kit/components/calendar-range/taiga-ui-kit-components-calendar-range.ts"],"sourcesContent":["import {\n    ChangeDetectionStrategy,\n    ChangeDetectorRef,\n    Component,\n    EventEmitter,\n    Inject,\n    Input,\n    Optional,\n    Output,\n} from '@angular/core';\nimport {\n    ALWAYS_FALSE_HANDLER,\n    nullableSame,\n    TUI_FIRST_DAY,\n    TUI_LAST_DAY,\n    TuiBooleanHandler,\n    TuiDay,\n    TuiDayLike,\n    TuiDayRange,\n    tuiDefaultProp,\n    TuiDestroyService,\n    TuiMapper,\n    TuiMonth,\n    tuiPure,\n    watch,\n} from '@taiga-ui/cdk';\nimport {\n    TUI_DEFAULT_MARKER_HANDLER,\n    TuiMarkerHandler,\n    TuiWithOptionalMinMax,\n} from '@taiga-ui/core';\nimport {TuiDayRangePeriod} from '@taiga-ui/kit/classes';\nimport {MAX_DAY_RANGE_LENGTH_MAPPER} from '@taiga-ui/kit/constants';\nimport {TUI_CALENDAR_DATA_STREAM, TUI_OTHER_DATE_TEXT} from '@taiga-ui/kit/tokens';\nimport {Observable} from 'rxjs';\nimport {takeUntil} from 'rxjs/operators';\n\n@Component({\n    selector: 'tui-calendar-range',\n    templateUrl: './calendar-range.template.html',\n    styleUrls: ['./calendar-range.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    providers: [TuiDestroyService],\n})\nexport class TuiCalendarRangeComponent implements TuiWithOptionalMinMax<TuiDay> {\n    @Input()\n    @tuiDefaultProp()\n    defaultViewedMonth: TuiMonth = TuiMonth.currentLocal();\n\n    @Input()\n    @tuiDefaultProp()\n    disabledItemHandler: TuiBooleanHandler<TuiDay> = ALWAYS_FALSE_HANDLER;\n\n    @Input()\n    @tuiDefaultProp()\n    markerHandler: TuiMarkerHandler = TUI_DEFAULT_MARKER_HANDLER;\n\n    @Input()\n    @tuiDefaultProp()\n    items: ReadonlyArray<TuiDayRangePeriod> = [];\n\n    @Input()\n    @tuiDefaultProp()\n    min: TuiDay = TUI_FIRST_DAY;\n\n    @Input()\n    @tuiDefaultProp()\n    max: TuiDay = TUI_LAST_DAY;\n\n    @Input()\n    @tuiDefaultProp()\n    minLength: TuiDayLike | null = null;\n\n    @Input()\n    @tuiDefaultProp()\n    maxLength: TuiDayLike | null = null;\n\n    @Output()\n    readonly rangeChange = new EventEmitter<TuiDayRange | null>();\n\n    value: TuiDayRange | null = null;\n\n    readonly maxLengthMapper: TuiMapper<TuiDay, TuiDay> = MAX_DAY_RANGE_LENGTH_MAPPER;\n\n    readonly monthShiftMapper: TuiMapper<TuiMonth, TuiMonth> = item =>\n        item.append({month: 1});\n\n    readonly mapper: TuiMapper<\n        ReadonlyArray<TuiDayRangePeriod>,\n        ReadonlyArray<TuiDayRangePeriod | string>\n    > = (\n        items,\n        min: TuiDay,\n        max: TuiDay | null,\n        minLength: TuiDayLike | null,\n        otherDateText: string,\n    ) => [\n        ...items.filter(\n            item =>\n                (minLength === null ||\n                    item.range.from.append(minLength).daySameOrBefore(item.range.to)) &&\n                item.range.to.daySameOrAfter(min) &&\n                (max === null || item.range.from.daySameOrBefore(max)),\n        ),\n        otherDateText,\n    ];\n\n    constructor(\n        @Inject(TUI_CALENDAR_DATA_STREAM)\n        @Optional()\n        valueChanges: Observable<TuiDayRange | null> | null,\n        @Inject(ChangeDetectorRef) changeDetectorRef: ChangeDetectorRef,\n        @Inject(TuiDestroyService) destroy$: TuiDestroyService,\n        @Inject(TUI_OTHER_DATE_TEXT) readonly otherDateText$: Observable<string>,\n    ) {\n        if (!valueChanges) {\n            return;\n        }\n\n        valueChanges\n            .pipe(watch(changeDetectorRef), takeUntil(destroy$))\n            .subscribe(value => {\n                this.value = value;\n            });\n    }\n\n    get calculatedDisabledItemHandler(): TuiBooleanHandler<TuiDay> {\n        return this.calculateDisabledItemHandler(\n            this.disabledItemHandler,\n            this.value,\n            this.minLength,\n        );\n    }\n\n    get computedMonth(): TuiMonth {\n        return this.value ? this.value.to : this.defaultViewedMonth;\n    }\n\n    isItemActive(item: string | TuiDayRangePeriod): boolean {\n        const {activePeriod} = this;\n\n        return (\n            (typeof item === 'string' && activePeriod === null) || activePeriod === item\n        );\n    }\n\n    onRangeChange(dayRange: TuiDayRange) {\n        this.updateValue(dayRange);\n    }\n\n    onDayClick(day: TuiDay) {\n        const {value} = this;\n\n        if (value === null || !value.isSingleDay) {\n            this.value = new TuiDayRange(day, day);\n\n            return;\n        }\n\n        this.updateValue(TuiDayRange.sort(value.from, day));\n    }\n\n    onItemSelect(item: string | TuiDayRangePeriod) {\n        if (typeof item !== 'string') {\n            this.updateValue(item.range.dayLimit(this.min, this.max));\n\n            return;\n        }\n\n        if (this.activePeriod !== null) {\n            this.updateValue(null);\n        }\n    }\n\n    updateValue(value: TuiDayRange | null) {\n        this.value = value;\n        this.rangeChange.emit(value);\n    }\n\n    private get activePeriod(): TuiDayRangePeriod | null {\n        return (\n            this.items.find(item =>\n                nullableSame<TuiDayRange>(\n                    this.value,\n                    item.range,\n                    (a, b) =>\n                        a.from.daySame(b.from.dayLimit(this.min, this.max)) &&\n                        a.to.daySame(b.to.dayLimit(this.min, this.max)),\n                ),\n            ) || null\n        );\n    }\n\n    @tuiPure\n    private calculateDisabledItemHandler(\n        disabledItemHandler: TuiBooleanHandler<TuiDay>,\n        value: TuiDayRange | null,\n        minLength: TuiDayLike | null,\n    ): TuiBooleanHandler<TuiDay> {\n        return item => {\n            if (!value || !value.isSingleDay || !minLength) {\n                return disabledItemHandler(item);\n            }\n\n            const disabledBefore = value.from.append(minLength, true).append({day: 1});\n            const disabledAfter = value.from.append(minLength).append({day: -1});\n            const inDisabledRange =\n                disabledBefore.dayBefore(item) && disabledAfter.dayAfter(item);\n\n            return inDisabledRange || disabledItemHandler(item);\n        };\n    }\n}\n","import {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {TuiMapperPipeModule, TuiPreventDefaultModule} from '@taiga-ui/cdk';\nimport {TuiCalendarModule, TuiDataListModule, TuiSvgModule} from '@taiga-ui/core';\nimport {TuiPrimitiveCalendarRangeModule} from '@taiga-ui/kit/internal/primitive-calendar-range';\n\nimport {TuiCalendarRangeComponent} from './calendar-range.component';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        TuiMapperPipeModule,\n        TuiPreventDefaultModule,\n        TuiCalendarModule,\n        TuiCalendarModule,\n        TuiSvgModule,\n        TuiDataListModule,\n        TuiPrimitiveCalendarRangeModule,\n    ],\n    declarations: [TuiCalendarRangeComponent],\n    exports: [TuiCalendarRangeComponent],\n})\nexport class TuiCalendarRangeModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}