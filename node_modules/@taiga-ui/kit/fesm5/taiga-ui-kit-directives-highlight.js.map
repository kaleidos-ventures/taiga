{"version":3,"file":"taiga-ui-kit-directives-highlight.js","sources":["ng://@taiga-ui/kit/directives/highlight/highlight.directive.ts","ng://@taiga-ui/kit/directives/highlight/highlight.module.ts","ng://@taiga-ui/kit/directives/highlight/taiga-ui-kit-directives-highlight.ts"],"sourcesContent":["import {DOCUMENT} from '@angular/common';\nimport {Directive, ElementRef, Inject, Input, OnChanges, Renderer2} from '@angular/core';\nimport {\n    px,\n    svgNodeFilter,\n    tuiDefaultProp,\n    TuiDestroyService,\n    TuiResizeService,\n} from '@taiga-ui/cdk';\nimport {Observable} from 'rxjs';\n\n// @dynamic\n@Directive({\n    selector: '[tuiHighlight]',\n    host: {\n        '[style.position]': '\"relative\"',\n        '[style.zIndex]': '0',\n    },\n    providers: [TuiDestroyService, TuiResizeService],\n})\nexport class TuiHighlightDirective implements OnChanges {\n    @Input()\n    @tuiDefaultProp()\n    tuiHighlight = '';\n\n    private readonly highlight: HTMLElement = this.setUpHighlight();\n\n    private readonly treeWalker = this.documentRef.createTreeWalker(\n        this.elementRef.nativeElement,\n        NodeFilter.SHOW_TEXT,\n        svgNodeFilter,\n        false,\n    );\n\n    constructor(\n        @Inject(DOCUMENT) private readonly documentRef: Document,\n        @Inject(ElementRef) private readonly elementRef: ElementRef<HTMLElement>,\n        @Inject(Renderer2) private readonly renderer: Renderer2,\n        @Inject(TuiResizeService) resize$: Observable<unknown>,\n    ) {\n        resize$.subscribe(() => {\n            this.updateStyles();\n        });\n    }\n\n    get match(): boolean {\n        return this.indexOf(this.elementRef.nativeElement.textContent) !== -1;\n    }\n\n    ngOnChanges() {\n        this.updateStyles();\n    }\n\n    private updateStyles() {\n        this.highlight.style.display = 'none';\n\n        if (!this.match) {\n            return;\n        }\n\n        this.treeWalker.currentNode = this.elementRef.nativeElement;\n\n        do {\n            const index = this.indexOf(this.treeWalker.currentNode.nodeValue);\n\n            if (index === -1) {\n                continue;\n            }\n\n            const range = this.documentRef.createRange();\n\n            range.setStart(this.treeWalker.currentNode, index);\n            range.setEnd(this.treeWalker.currentNode, index + this.tuiHighlight.length);\n\n            const hostRect = this.elementRef.nativeElement.getBoundingClientRect();\n            const {left, top, width, height} = range.getBoundingClientRect();\n            const {style} = this.highlight;\n\n            style.left = px(left - hostRect.left);\n            style.top = px(top - hostRect.top);\n            style.width = px(width);\n            style.height = px(height);\n            style.display = 'block';\n\n            return;\n        } while (this.treeWalker.nextNode());\n    }\n\n    private indexOf(source: string | null): number {\n        return !source || !this.tuiHighlight\n            ? -1\n            : source.toLowerCase().indexOf(this.tuiHighlight.toLowerCase());\n    }\n\n    private setUpHighlight(): HTMLElement {\n        const highlight = this.renderer.createElement('div');\n        const {style} = highlight;\n\n        style.background = 'var(--tui-selection)';\n        style.zIndex = '-1';\n        style.position = 'absolute';\n        this.renderer.appendChild(this.elementRef.nativeElement, highlight);\n\n        return highlight;\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {TuiHighlightDirective} from './highlight.directive';\n\n@NgModule({\n    declarations: [TuiHighlightDirective],\n    exports: [TuiHighlightDirective],\n})\nexport class TuiHighlightModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":";;;;;;AAWA;;IAuBI,+BACuC,WAAqB,EACnB,UAAmC,EACpC,QAAmB,EAC7B,OAA4B;QAJ1D,iBASC;QARsC,gBAAW,GAAX,WAAW,CAAU;QACnB,eAAU,GAAV,UAAU,CAAyB;QACpC,aAAQ,GAAR,QAAQ,CAAW;QAd3D,iBAAY,GAAG,EAAE,CAAC;QAED,cAAS,GAAgB,IAAI,CAAC,cAAc,EAAE,CAAC;QAE/C,eAAU,GAAG,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAC3D,IAAI,CAAC,UAAU,CAAC,aAAa,EAC7B,UAAU,CAAC,SAAS,EACpB,aAAa,EACb,KAAK,CACR,CAAC;QAQE,OAAO,CAAC,SAAS,CAAC;YACd,KAAI,CAAC,YAAY,EAAE,CAAC;SACvB,CAAC,CAAC;KACN;IAED,sBAAI,wCAAK;aAAT;YACI,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC;SACzE;;;OAAA;IAED,2CAAW,GAAX;QACI,IAAI,CAAC,YAAY,EAAE,CAAC;KACvB;IAEO,4CAAY,GAApB;QACI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QAEtC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;YACb,OAAO;SACV;QAED,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;QAE5D,GAAG;YACC,IAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;YAElE,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;gBACd,SAAS;aACZ;YAED,IAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC;YAE7C,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;YACnD,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;YAE5E,IAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,qBAAqB,EAAE,CAAC;YACjE,IAAA,kCAA0D,EAAzD,cAAI,EAAE,cAAG,EAAE,gBAAK,EAAE,kBAAuC,CAAC;YAC1D,IAAA,4BAAK,CAAmB;YAE/B,KAAK,CAAC,IAAI,GAAG,EAAE,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC;YACtC,KAAK,CAAC,GAAG,GAAG,EAAE,CAAC,KAAG,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;YACnC,KAAK,CAAC,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC;YACxB,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC;YAC1B,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;YAExB,OAAO;SACV,QAAQ,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,EAAE;KACxC;IAEO,uCAAO,GAAf,UAAgB,MAAqB;QACjC,OAAO,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,YAAY;cAC9B,CAAC,CAAC;cACF,MAAM,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC,CAAC;KACvE;IAEO,8CAAc,GAAtB;QACI,IAAM,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC9C,IAAA,uBAAK,CAAc;QAE1B,KAAK,CAAC,UAAU,GAAG,sBAAsB,CAAC;QAC1C,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC;QACpB,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;QAC5B,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;QAEpE,OAAO,SAAS,CAAC;KACpB;;gBArEmD,QAAQ,uBAAvD,MAAM,SAAC,QAAQ;gBACiC,UAAU,uBAA1D,MAAM,SAAC,UAAU;gBAC4B,SAAS,uBAAtD,MAAM,SAAC,SAAS;gBACkB,UAAU,uBAA5C,MAAM,SAAC,gBAAgB;;IAf5B;QAFC,KAAK,EAAE;QACP,cAAc,EAAE;+DACC;IAHT,qBAAqB;QARjC,SAAS,CAAC;YACP,QAAQ,EAAE,gBAAgB;YAC1B,IAAI,EAAE;gBACF,kBAAkB,EAAE,YAAY;gBAChC,gBAAgB,EAAE,GAAG;aACxB;YACD,SAAS,EAAE,CAAC,iBAAiB,EAAE,gBAAgB,CAAC;SACnD,CAAC;QAgBO,WAAA,MAAM,CAAC,QAAQ,CAAC,CAAA;QAChB,WAAA,MAAM,CAAC,UAAU,CAAC,CAAA;QAClB,WAAA,MAAM,CAAC,SAAS,CAAC,CAAA;QACjB,WAAA,MAAM,CAAC,gBAAgB,CAAC,CAAA;OAlBpB,qBAAqB,CAqFjC;IAAD,4BAAC;CArFD;;;ICbA;KAAkC;IAArB,kBAAkB;QAJ9B,QAAQ,CAAC;YACN,YAAY,EAAE,CAAC,qBAAqB,CAAC;YACrC,OAAO,EAAE,CAAC,qBAAqB,CAAC;SACnC,CAAC;OACW,kBAAkB,CAAG;IAAD,yBAAC;CAAlC;;ACPA;;;;;;"}